4
(20140410-2-期中考试试题v4a答案.docx)进程管理
（20分）进程/线程管理（Process/Thread
Management）是操作系统的重要职能之一，现代操作系统基于硬件所提供的内存管理单元（Memory Management
Unit），可以为进程提供相互隔离的虚拟地址空间，为线程提供共享的虚拟地址空间。以下我们对32位x86架构的uCore所实现的进程管理机制进行讨论。
1) 在ucore中，管理一个用户进程的进程控制块数据结构为proc_struct，管理一个内核线程的线程控制块数据结构为__(1a)__。在proc_st
ruct中，为了有效管理用户进程，请问可唯一标识一个进程的field是__(1b)__；用户进程控制块与内核线程控制块相比，数据内容肯定不同的field包括
__(1c)__、__(1d)__、__(1e)__。
2) 在ucore中，一个用户进程具有“自己”的用户栈，当用户进程通过系统调用进入到内核态开始继续执行ucore指令时，进程的页表起始地址是否会改变？__(
2a)__。当用户进程在用户态执行时，硬件产生了一个中断，打断了用户进程的执行，这时CPU将开始执行中断服务例程，，这个时候的页表起始地址是否已经不是被打断
的用户进程的页表起始地址了？__(2b)_。
3) 在ucore中，当用户进程访问的某个虚拟地址的映射关系不在TLB中时，是否一定会产生异常？__(3a)__。当用户进程访问的某个虚拟地址在其页表中没有
valid的页表项，是否一定回产生异常？__(3b)__。
4) 在ucore中，当用户进程A与用户进程B进行进程上下文切换时，需要保存相关的寄存器内容，请问是否需要保存CS？__(4a)__。是否需要保存EIP？_
_(4b)_。是否需要保存SS？__(4c)__。是否需要保存ESP？__(4d)__。
5) 在ucore中，如果当父进程创建子进程时，如果没有COW机制，则fork系统调用会创建新的子进程的进程控制块，创建新的子进程的页表，并把父进程的代码段
和数据段所占的物理内存空间复制一份到新的物理内存空间，并更新子进程页表。如果采用了COW机制，则fork系统调用的处理过程是？（用不超过6行文字进行描述）  
- [x]

知识点:线程管理实验
出处:网络
难度:1
> （20分）进程/线程管理（Process/Thread
> Management）是操作系统的重要职能之一，现代操作系统基于硬件所提供的内存管理单元（Memory Management
> Unit），可以为进程提供相互隔离的虚拟地址空间，为线程提供共享的虚拟地址空间。以下我们对32位x86架构的uCore所实现的进程管理机制进行讨论。
> 每空1分
> 1) 在ucore中，管理一个用户进程的进程控制块数据结构为proc_struct，管理一个内核线程的线程控制块数据结构为__proc_struct____
> _。在proc_struct中，为了有效管理用户进程，请问可唯一标识一个进程的field是__pid_____；用户进程控制块与内核线程控制块相比，数据内容
> 肯定不同的field包括___pid____、__kstack_____、__mm_____。
> 2) 在ucore中，一个用户进程具有“自己”的用户栈，当用户进程通过系统调用进入到内核态开始继续执行ucore指令时，进程的页表起始地址是否会改变？_ _
> 不会_____。当用户进程在用户态执行时，硬件产生了一个中断，打断了用户进程的执行，这时CPU将开始执行中断服务例程，，这个时候的页表起始地址是否已经不是被
> 打断的用户进程的页表起始地址了？___不是____。
> 3) 在ucore中，当用户进程访问的某个虚拟地址的映射关系不在TLB中时，是否一定会产生异常？___否____。当用户进程访问的某个虚拟地址在其页表中没有
> valid的页表项，是否一定回产生异常？____是___。
> 4) 在ucore中，当用户进程A与用户进程B进行进程上下文切换时，需要保存相关的寄存器内容，请问是否需要保存CS？__否_____。是否需要保存EIP？_
> __是____。是否需要保存SS？___否____。是否需要保存ESP？___是____。
> 5) 在ucore中，如果当父进程创建子进程时，如果没有COW机制，则fork系统调用会创建新的子进程的进程控制块，创建新的子进程的页表，并把父进程的代码段
> 和数据段所占的物理内存空间复制一份到新的物理内存空间，并更新子进程页表。如果采用了COW机制，则fork系统调用的处理过程是？（用不超过6行文字进行描述）
> 1 创建新的子进程的进程控制块 1分
> 2 分配内核堆栈kstack 2分
> 3 共享进程控制块中的mm field 2分
> 4 在子进程的内核堆栈上设置trapframe 如果答出，也给1分
> 5 把用户空间的进程页表项设置只读 （这样对页写会触发异常，从而进一步完成COW机制） 2分
> 6 设置父进程返回值为子进程的pid，子进程的返回值为0 如果答出，也给1分
